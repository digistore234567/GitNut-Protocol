{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gitnut.dev/schemas/release-metadata.schema.json",
  "title": "release-metadata.schema",
  "description": "Canonical release metadata for a specific version, including artifact links and verification proofs.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "projectSlug",
    "version",
    "source",
    "artifacts",
    "attestations"
  ],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "enum": [
        "1.0.0"
      ]
    },
    "projectSlug": {
      "type": "string",
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+){0,39}$"
    },
    "version": {
      "type": "string",
      "description": "Semantic Versioning string.",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
    },
    "channel": {
      "type": "string",
      "enum": [
        "stable",
        "beta",
        "alpha",
        "rc",
        "nightly",
        "custom"
      ]
    },
    "publishedAt": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "provider",
        "repo",
        "commit"
      ],
      "properties": {
        "provider": {
          "type": "string",
          "enum": [
            "github",
            "gitlab",
            "bitbucket",
            "generic"
          ]
        },
        "repo": {
          "type": "string",
          "minLength": 3,
          "maxLength": 200
        },
        "ref": {
          "type": "string",
          "maxLength": 200
        },
        "commit": {
          "type": "string",
          "pattern": "^[a-f0-9]{40}$"
        },
        "treeHash": {
          "type": "string",
          "description": "Optional git tree hash.",
          "pattern": "^[a-f0-9]{40}$"
        },
        "subdir": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "artifacts": {
      "type": "array",
      "minItems": 1,
      "maxItems": 64,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "name",
          "kind",
          "hash",
          "sizeBytes",
          "uri"
        ],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200
          },
          "kind": {
            "type": "string",
            "enum": [
              "source-archive",
              "build-archive",
              "sbom",
              "attestation",
              "other"
            ]
          },
          "format": {
            "type": "string",
            "maxLength": 80
          },
          "hash": {
            "type": "string",
            "description": "Lowercase hex SHA-256 digest.",
            "pattern": "^[a-f0-9]{64}$"
          },
          "sizeBytes": {
            "type": "integer",
            "minimum": 0
          },
          "uri": {
            "type": "string",
            "format": "uri",
            "minLength": 1
          },
          "contentType": {
            "type": "string",
            "maxLength": 120
          }
        }
      }
    },
    "attestations": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "source",
        "build",
        "release"
      ],
      "properties": {
        "source": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "hash",
            "uri"
          ],
          "properties": {
            "hash": {
              "type": "string",
              "description": "Lowercase hex SHA-256 digest.",
              "pattern": "^[a-f0-9]{64}$"
            },
            "uri": {
              "type": "string",
              "format": "uri",
              "minLength": 1
            }
          }
        },
        "build": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "hash",
            "uri"
          ],
          "properties": {
            "hash": {
              "type": "string",
              "description": "Lowercase hex SHA-256 digest.",
              "pattern": "^[a-f0-9]{64}$"
            },
            "uri": {
              "type": "string",
              "format": "uri",
              "minLength": 1
            }
          }
        },
        "release": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "hash",
            "uri"
          ],
          "properties": {
            "hash": {
              "type": "string",
              "description": "Lowercase hex SHA-256 digest.",
              "pattern": "^[a-f0-9]{64}$"
            },
            "uri": {
              "type": "string",
              "format": "uri",
              "minLength": 1
            }
          }
        },
        "sbom": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "hash": {
              "type": "string",
              "description": "Lowercase hex SHA-256 digest.",
              "pattern": "^[a-f0-9]{64}$"
            },
            "uri": {
              "type": "string",
              "format": "uri",
              "minLength": 1
            },
            "format": {
              "type": "string",
              "enum": [
                "spdx-json",
                "cyclonedx-json"
              ]
            }
          }
        }
      }
    },
    "onChain": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cluster": {
          "type": "string",
          "enum": [
            "localnet",
            "devnet",
            "testnet",
            "mainnet-beta"
          ]
        },
        "programId": {
          "type": "string",
          "description": "Solana public key as base58 string.",
          "minLength": 32,
          "maxLength": 64
        },
        "projectPda": {
          "type": "string",
          "description": "Solana public key as base58 string.",
          "minLength": 32,
          "maxLength": 64
        },
        "versionPda": {
          "type": "string",
          "description": "Solana public key as base58 string.",
          "minLength": 32,
          "maxLength": 64
        },
        "tx": {
          "type": "string",
          "description": "Solana public key as base58 string.",
          "minLength": 32,
          "maxLength": 64
        }
      }
    },
    "notes": {
      "type": "string",
      "maxLength": 20000
    }
  },
  "defs": {
    "semver": {
      "type": "string",
      "description": "Semantic Versioning string.",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
    },
    "sha256": {
      "type": "string",
      "description": "Lowercase hex SHA-256 digest.",
      "pattern": "^[a-f0-9]{64}$"
    },
    "ed25519PublicKey": {
      "type": "string",
      "description": "Ed25519 public key as base58 string.",
      "minLength": 32,
      "maxLength": 64
    },
    "solanaPubkey": {
      "type": "string",
      "description": "Solana public key as base58 string.",
      "minLength": 32,
      "maxLength": 64
    },
    "uri": {
      "type": "string",
      "format": "uri",
      "minLength": 1
    },
    "datetime": {
      "type": "string",
      "format": "date-time"
    }
  }
}